<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ™ãƒ“ãƒ¼ã‚·ãƒƒã‚¿ãƒ¼ï¼ˆä¸€æ™‚é ã‹ã‚Šï¼‰åˆ©ç”¨å†…è¨³æ›¸</title>
    <style>
        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'MS Gothic', monospace;
            font-size: 12px;
            line-height: 1.4;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
            display: flex;
        }

        /* ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ */
        .toolbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: white;
            border-bottom: 1px solid #ddd;
            padding: 10px 20px;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .toolbar button {
            padding: 8px 16px;
            border: 1px solid #ddd;
            background: white;
            cursor: pointer;
            border-radius: 4px;
            font-size: 12px;
        }

        .toolbar button:hover {
            background: #f0f0f0;
        }

        .toolbar button.active {
            background: #007acc;
            color: white;
        }

        .toolbar select {
            padding: 6px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 12px;
        }

        .toolbar-divider {
            height: 20px;
            width: 1px;
            background: #ddd;
        }

        /* ã‚µã‚¤ãƒ‰ãƒ‘ãƒãƒ« */
        .sidebar {
            position: fixed;
            top: 60px;
            left: 0;
            width: 300px;
            height: calc(100vh - 100px);
            background: white;
            border-right: 1px solid #ddd;
            padding: 20px;
            overflow-y: auto;
            transform: translateX(-100%);
            transition: transform 0.3s ease;
            z-index: 999;
        }

        .sidebar.open {
            transform: translateX(0);
        }

        .sidebar h3 {
            margin: 0 0 15px 0;
            font-size: 14px;
            font-weight: bold;
        }

        .sidebar .setting-group {
            margin-bottom: 20px;
        }

        .sidebar .setting-group label {
            display: block;
            margin-bottom: 5px;
            font-size: 12px;
            font-weight: bold;
        }

        .sidebar .setting-group select,
        .sidebar .setting-group input {
            width: 100%;
            padding: 6px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 12px;
        }

        .sidebar .margin-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        /* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¨ãƒªã‚¢ */
        .main-content {
            margin-top: 60px;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            transition: margin-left 0.3s ease;
            gap: 40px;
        }

        .main-content.sidebar-open {
            margin-left: 300px;
        }

        /* ãƒšãƒ¼ã‚¸ã‚³ãƒ³ãƒ†ãƒŠ */
        .page-container {
            background: white;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            position: relative;
            transform-origin: top center;
            transition: transform 0.2s ease;
            display: block;
        }

        /* A4ãƒšãƒ¼ã‚¸ã‚µã‚¤ã‚º */
        .page-container.a4-portrait {
            width: 210mm;
            min-height: 297mm;
            max-height: 297mm;
            padding: var(--page-margin-top, 20mm) var(--page-margin-right, 20mm) var(--page-margin-bottom, 20mm) var(--page-margin-left, 20mm);
            overflow: hidden;
            page-break-after: always;
        }

        .page-container.a4-landscape {
            width: 297mm;
            min-height: 210mm;
            max-height: 210mm;
            padding: var(--page-margin-top, 20mm) var(--page-margin-right, 20mm) var(--page-margin-bottom, 20mm) var(--page-margin-left, 20mm);
            overflow: hidden;
            page-break-after: always;
        }

        /* ãƒšãƒ¼ã‚¸åˆ†å‰²ã®ãŸã‚ã®è¿½åŠ ã‚¹ã‚¿ã‚¤ãƒ« */
        .page-overflow {
            height: auto !important;
            max-height: none !important;
            overflow: visible !important;
        }

        .page-content {
            height: 100%;
            overflow: hidden;
        }

        /* ãƒ†ãƒ¼ãƒ–ãƒ«åˆ†å‰²ç”¨ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .table-continuation {
            margin-top: 0;
        }

        .table-continuation thead {
            background-color: #f0f0f0;
        }

        /* ãƒšãƒ¼ã‚¸åˆ†å‰²æ™‚ã®è¦ç´ åˆ¶å¾¡ */
        .avoid-break {
            page-break-inside: avoid;
        }

        .break-before {
            page-break-before: always;
        }

        /* ã‚ºãƒ¼ãƒ  */
        .zoom-50 { transform: scale(0.5); }
        .zoom-75 { transform: scale(0.75); }
        .zoom-100 { transform: scale(1); }
        .zoom-125 { transform: scale(1.25); }
        .zoom-150 { transform: scale(1.5); }

        /* ãƒšãƒ¼ã‚¸ç•ªå·è¡¨ç¤º */
        .page-number-display {
            position: absolute;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
        }

        /* ãƒ•ã‚©ãƒ¼ãƒ ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆæ—¢å­˜ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ç¶™æ‰¿ï¼‰ */
        .header {
            text-align: center;
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 20px;
        }
        
        .year-field {
            display: inline-block;
            margin-left: 20px;
            font-size: 14px;
        }
        
        .form-section {
            margin-bottom: 15px;
        }
        
        .applicant-info {
            border: 2px solid black;
            padding: 5px;
            margin-bottom: 10px;
        }
        
        .applicant-info .text-display {
            border-bottom: 1px solid black;
            display: inline-block;
            width: 200px;
            font-size: 12px;
            font-family: inherit;
            min-height: 18px;
            padding: 2px 0;
        }
        
        .child-info {
            margin-left: 20px;
        }
        
        .child-info .text-display {
            border-bottom: 1px solid black;
            display: inline-block;
            width: 200px;
            font-size: 12px;
            font-family: inherit;
            min-height: 18px;
            padding: 2px 0;
        }
        
        .notes-box {
            border: 1px solid black;
            padding: 10px;
            margin-bottom: 15px;
            background-color: #f9f9f9;
        }
        
        .notes-box ul {
            margin: 0;
            padding-left: 20px;
        }
        
        .usage-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        
        .usage-table th,
        .usage-table td {
            border: 1px solid black;
            padding: 3px 5px;
            text-align: center;
            font-size: 11px;
        }
        
        /* ã™ã¹ã¦ã®ãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¤ºãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®åŸºæœ¬ã‚¹ã‚¿ã‚¤ãƒ« */
        .usage-table .text-display {
            font-family: inherit;
            font-size: 11px;
            padding: 2px;
            min-height: 16px;
            display: inline-block;
            width: 100%;
            text-align: center;
        }
        
        .usage-table th {
            background-color: #e6e6e6;
            font-weight: bold;
        }
        
        .date-section {
            border: 2px solid black;
            padding: 5px;
            margin-bottom: 10px;
        }
        
        .date-section .text-display {
            border-bottom: 1px solid black;
            display: inline-block;
            width: 50px;
            text-align: center;
            font-size: 12px;
            font-family: inherit;
            min-height: 18px;
            padding: 2px 0;
        }
        
        .calculation-section {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 20px 0;
            font-size: 14px;
        }
        
        .calc-box {
            border: 2px solid black;
            padding: 5px 10px;
            min-width: 80px;
            text-align: center;
        }
        
        .calc-box .text-display {
            text-align: center;
            width: 100%;
            font-size: 14px;
            font-family: inherit;
            min-height: 20px;
            display: inline-block;
            padding: 2px 0;
        }
        
        .subsidy-info {
            font-size: 10px;
            margin: 10px 0;
        }
        
        .payment-section {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-top: 20px;
        }
        
        .payment-box {
            border: 2px solid black;
            padding: 8px;
            text-align: center;
            min-width: 100px;
        }
        
        .payment-box.highlight {
            background-color: #ffff99;
        }
        
        .payment-box .text-display {
            text-align: center;
            width: 100%;
            font-size: 12px;
            font-family: inherit;
            min-height: 18px;
            display: inline-block;
            padding: 2px 0;
        }
        
        .page-number {
            text-align: center;
            margin-top: 30px;
            font-size: 12px;
        }
        
        .time-range-input {
            width: 100%;
            text-align: center;
            box-sizing: border-box;
            font-size: 11px;
        }
        
        .duration-input {
            width: 100%;
            text-align: center;
            box-sizing: border-box;
            font-size: 11px;
        }
        
        .hour-input {
            width: 100%;
            max-width: 40px;
            text-align: center;
            box-sizing: border-box;
        }
        
        .minute-input {
            width: 100%;
            max-width: 40px;
            text-align: center;
            box-sizing: border-box;
        }
        
        .amount-input {
            width: 100%;
            text-align: right;
            box-sizing: border-box;
        }
        
        /* æ—¥ä¸­åˆ©ç”¨ã¨å¤œé–“åˆ©ç”¨ã®åˆ—å¹…ã‚’å‡ç­‰ã« */
        .usage-table {
            table-layout: auto;
        }
        
        /* å„åˆ—ã®å¹…ã‚’è¨­å®š */
        .usage-table td:nth-child(1) { width: 10%; }  /* åˆ©ç”¨æ—¥ */
        .usage-table td:nth-child(2) { width: 18%; } /* æ—¥ä¸­åˆ©ç”¨æ™‚é–“ */
        .usage-table td:nth-child(3) { width: 12%; } /* æ—¥ä¸­åˆ©ç”¨æ™‚é–“æ•° */
        .usage-table td:nth-child(4) { width: 18%; } /* å¤œé–“åˆ©ç”¨æ™‚é–“ */
        .usage-table td:nth-child(5) { width: 12%; } /* å¤œé–“åˆ©ç”¨æ™‚é–“æ•° */
        .usage-table td:nth-child(6) { width: 15%; } /* å®Ÿæ”¯æ‰•é¡ */

        /* å°åˆ·ã‚¹ã‚¿ã‚¤ãƒ« */
        @media print {
            /* å°åˆ·æ™‚ã®ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚¸ãƒ³ã‚’0ã«è¨­å®š */
            @page {
                size: A4 portrait;
                margin: 0;
            }

            /* ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ã¨ã‚µã‚¤ãƒ‰ãƒãƒ¼ã‚’å®Œå…¨ã«éè¡¨ç¤º */
            .toolbar,
            .sidebar,
            .page-number-display {
                display: none !important;
                visibility: hidden !important;
                position: absolute !important;
                left: -9999px !important;
            }

            * {
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }

            html, body {
                background: white !important;
                margin: 0 !important;
                padding: 0 !important;
            }

            .main-content {
                margin: 0 !important;
                margin-top: 0 !important;
                padding: 0 !important;
                display: block !important;
            }

            .page-container {
                box-shadow: none !important;
                margin: 0 !important;
                transform: none !important;
                page-break-after: always;
                page-break-inside: avoid;
                width: 210mm !important;
                min-height: 297mm !important;
                /* å…ƒã®ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ï¼ˆä½™ç™½ï¼‰ã‚’ç¶­æŒ */
                padding: 20mm 20mm 20mm 20mm !important;
            }

            .page-container:last-child {
                page-break-after: auto;
            }

            /* å°åˆ·æ™‚ã¯ãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¤ºã®æ ç·šã‚’éè¡¨ç¤º */
            .usage-table .text-display,
            .info-input,
            .applicant-info .text-display,
            .child-info .text-display,
            .date-section .text-display,
            .calc-box .text-display,
            .payment-box .text-display {
                border: none !important;
                background: transparent !important;
            }
        }

        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
            }

            .main-content.sidebar-open {
                margin-left: 0;
            }

            .page-container {
                width: 100%;
                min-width: 300px;
            }
        }

        /* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* å°åˆ·ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ¢ãƒ¼ãƒ‰ */
        .print-preview-mode {
            background-color: #f0f0f0;
        }
        
        .print-preview-mode .page-container {
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            margin: 20px auto;
        }
        
        .print-preview-mode .toolbar {
            background: #e9ecef;
            border-bottom: 2px solid #dee2e6;
        }
    </style>
</head>
<body>

    <!-- ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ -->
    <div class="toolbar">
        <span style="font-weight: bold; color: #333;">ğŸ“„ ç”³è«‹æ›¸ï¼ˆå°åˆ·ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼‰</span>
        
        <div class="toolbar-divider"></div>
        
        <a href="/frontend/pdf-extractor.html" style="color: #666; text-decoration: none; padding: 8px 15px; border-radius: 4px; font-size: 14px;">â† æœ€åˆã‹ã‚‰ã‚„ã‚Šç›´ã™</a>

        <div class="toolbar-divider"></div>

        <button id="printBtn">ğŸ–¨ï¸ å°åˆ·</button>

        <div class="toolbar-divider"></div>

        <button id="loadJsonBtn">ğŸ“‚ JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚€</button>
        <input type="file" id="jsonFileInput" accept=".json" style="display: none;">

        <div class="toolbar-divider"></div>

        <span style="color: #2196F3; font-weight: bold;">Step 3 / 3</span>
        <span style="margin-left: 20px; color: #666; font-size: 12px;">å°åˆ·ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</span>
    </div>

    <!-- ã‚µã‚¤ãƒ‰ãƒãƒ¼è¨­å®šãƒ‘ãƒãƒ« -->
    <div class="sidebar" id="sidebar">
        <h3>ãƒšãƒ¼ã‚¸è¨­å®š</h3>
        
        <div class="setting-group">
            <label>ç”¨ç´™ã‚µã‚¤ã‚º:</label>
            <select id="paperSize">
                <option value="a4">A4</option>
                <option value="letter">Letter</option>
                <option value="legal">Legal</option>
            </select>
        </div>
        
        <div class="setting-group">
            <label>å°åˆ·æ–¹å‘:</label>
            <select id="orientation">
                <option value="portrait">ç¸¦</option>
                <option value="landscape">æ¨ª</option>
            </select>
        </div>
        
        <div class="setting-group">
            <label>ãƒãƒ¼ã‚¸ãƒ³ (mm):</label>
            <div class="margin-inputs">
                <input type="number" id="marginTop" placeholder="ä¸Š" value="20">
                <input type="number" id="marginRight" placeholder="å³" value="20">
                <input type="number" id="marginBottom" placeholder="ä¸‹" value="20">
                <input type="number" id="marginLeft" placeholder="å·¦" value="20">
            </div>
        </div>
        
        <div class="setting-group">
            <label>ãƒ˜ãƒƒãƒ€ãƒ¼:</label>
            <input type="text" id="headerText" placeholder="ãƒ˜ãƒƒãƒ€ãƒ¼ãƒ†ã‚­ã‚¹ãƒˆ">
        </div>
        
        <div class="setting-group">
            <label>ãƒ•ãƒƒã‚¿ãƒ¼:</label>
            <input type="text" id="footerText" placeholder="ãƒ•ãƒƒã‚¿ãƒ¼ãƒ†ã‚­ã‚¹ãƒˆ">
        </div>
        
        <button onclick="applySettings()" style="width: 100%; margin-top: 20px;">è¨­å®šã‚’é©ç”¨</button>
    </div>

    <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
    <div class="main-content" id="mainContent">
        <!-- ãƒšãƒ¼ã‚¸1 -->
        <div class="page-container a4-portrait" id="page1">
            <div class="page-number-display">ãƒšãƒ¼ã‚¸ 1</div>
            
            <div class="header">
                ãƒ™ãƒ“ãƒ¼ã‚·ãƒƒã‚¿ãƒ¼ï¼ˆä¸€æ™‚é ã‹ã‚Šï¼‰åˆ©ç”¨å†…è¨³æ›¸
                <span class="year-field">ã€ä»¤å’Œ <span class="text-display" style="width: 30px; border-bottom: 1px solid black; display: inline-block; text-align: center; min-height: 18px; padding: 2px 0;"></span> å¹´åº¦ã€‘</span>
            </div>
            
            <style>
                .info-section {
                    margin-bottom: 20px;
                }
                .info-row {
                    display: flex;
                    align-items: center;
                    margin-bottom: 10px;
                    gap: 30px;
                }
                .info-label {
                    font-weight: bold;
                    min-width: 80px;
                    white-space: nowrap;
                }
                .info-input {
                    border-bottom: 2px solid black;
                    flex: 1;
                    font-size: 14px;
                    font-family: inherit;
                    padding: 5px 0;
                    min-height: 20px;
                    display: inline-block;
                }
            </style>
            
            <div class="info-section">
                <div class="info-row">
                    <div class="info-label">ç”³è«‹è€…å</div>
                    <span class="info-input text-display"></span>
                </div>
                <div class="info-row">
                    <div class="info-label">å…ç«¥å</div>
                    <span class="info-input text-display"></span>
                </div>
            </div>
            
            <div class="notes-box">
                <ul>
                    <li>7æ™‚ï½22æ™‚ã®åˆ©ç”¨ã¨22æ™‚ï½ç¿Œ7æ™‚ã®åˆ©ç”¨ã¯è¨˜è¼‰æ¬„ã‚’åˆ†ã‘ã¦è¨˜å…¥ã—ã¦ãã ã•ã„ã€‚</li>
                    <li>æ”¯æ‰•ã„ã«æ‰ä¸¦åŒºå­è‚²ã¦å¿œæ´åˆ¸ã‚’ä½¿ç”¨ã—ãŸåˆ©ç”¨åˆ†ã«ã¤ã„ã¦ã¯è£œåŠ©å¯¾è±¡å¤–ã§ã™ã€‚</li>
                    <li>å…¥ä¼šé‡‘ã€ä¼šè²»ã€ç™»éŒ²æ–™ã€äº¤é€šè²»ã€ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ–™ã€ä¿é™ºæ–™ã€ãŠã‚€ã¤ä»£ç­‰ã®å®Ÿè²»ç­‰ã¯è£œåŠ©å¯¾è±¡å¤–ã§ã™ã€‚</li>
                </ul>
            </div>
            
            <div class="date-section">
                ä»¤å’Œ <span class="text-display" id="year" style="width: 30px; border-bottom: 1px solid black; display: inline-block; text-align: center; min-height: 18px; padding: 2px 0;">7</span> å¹´ <span class="text-display" id="month" style="width: 30px; border-bottom: 1px solid black; display: inline-block; text-align: center; min-height: 18px; padding: 2px 0;">4</span> æœˆåˆ†ã€€ã€€äº‹æ¥­è€…ã¸ã®æ”¯æ‰•é‡‘é¡ã‹ã‚‰ã€äº¤é€šè²»ã‚„ã‚¯ãƒ¼ãƒãƒ³ç­‰ã®å‰²å¼•ã‚’å·®ã—å¼•ã„ãŸã€ç´”ç„¶ãŸã‚‹ä¿è‚²æ–™ã‚’è¨˜è¼‰ã€‚
            </div>
            
            <table class="usage-table">
                <thead>
                    <tr>
                        <th rowspan="3">åˆ©ç”¨æ—¥</th>
                        <th colspan="6">åˆ©ç”¨æ™‚é–“</th>
                        <th rowspan="3">å®Ÿæ”¯æ‰•é¡</th>
                    </tr>
                    <tr>
                        <th colspan="3">æ—¥ä¸­åˆ©ç”¨ï¼ˆ7æ™‚ï½22æ™‚ï¼‰</th>
                        <th colspan="3">å¤œé–“åˆ©ç”¨ï¼ˆ22æ™‚ï½ç¿Œ7æ™‚ï¼‰</th>
                    </tr>
                    <tr>
                        <th colspan="2">æ™‚é–“</th>
                        <th>â—‹æ™‚é–“â—‹åˆ†</th>
                        <th colspan="2">æ™‚é–“</th>
                        <th>â—‹æ™‚é–“â—‹åˆ†</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- 10è¡Œã®ãƒ‡ãƒ¼ã‚¿å…¥åŠ›è¡Œ -->
                    <tr><td><span class="text-display" style="width: 100%;"></span></td><td colspan="2"><span class="text-display time-range-input"></span></td><td><span class="text-display duration-input"></span></td><td colspan="2"><span class="text-display time-range-input"></span></td><td><span class="text-display duration-input"></span></td><td><span class="text-display amount-input"></span></td></tr>
                    <tr><td><span class="text-display" style="width: 100%;"></span></td><td colspan="2"><span class="text-display time-range-input"></span></td><td><span class="text-display duration-input"></span></td><td colspan="2"><span class="text-display time-range-input"></span></td><td><span class="text-display duration-input"></span></td><td><span class="text-display amount-input"></span></td></tr>
                    <tr><td><span class="text-display" style="width: 100%;"></span></td><td colspan="2"><span class="text-display time-range-input"></span></td><td><span class="text-display duration-input"></span></td><td colspan="2"><span class="text-display time-range-input"></span></td><td><span class="text-display duration-input"></span></td><td><span class="text-display amount-input"></span></td></tr>
                    <tr><td><span class="text-display" style="width: 100%;"></span></td><td colspan="2"><span class="text-display time-range-input"></span></td><td><span class="text-display duration-input"></span></td><td colspan="2"><span class="text-display time-range-input"></span></td><td><span class="text-display duration-input"></span></td><td><span class="text-display amount-input"></span></td></tr>
                    <tr><td><span class="text-display" style="width: 100%;"></span></td><td colspan="2"><span class="text-display time-range-input"></span></td><td><span class="text-display duration-input"></span></td><td colspan="2"><span class="text-display time-range-input"></span></td><td><span class="text-display duration-input"></span></td><td><span class="text-display amount-input"></span></td></tr>
                    <tr><td><span class="text-display" style="width: 100%;"></span></td><td colspan="2"><span class="text-display time-range-input"></span></td><td><span class="text-display duration-input"></span></td><td colspan="2"><span class="text-display time-range-input"></span></td><td><span class="text-display duration-input"></span></td><td><span class="text-display amount-input"></span></td></tr>
                    <tr><td><span class="text-display" style="width: 100%;"></span></td><td colspan="2"><span class="text-display time-range-input"></span></td><td><span class="text-display duration-input"></span></td><td colspan="2"><span class="text-display time-range-input"></span></td><td><span class="text-display duration-input"></span></td><td><span class="text-display amount-input"></span></td></tr>
                    <tr><td><span class="text-display" style="width: 100%;"></span></td><td colspan="2"><span class="text-display time-range-input"></span></td><td><span class="text-display duration-input"></span></td><td colspan="2"><span class="text-display time-range-input"></span></td><td><span class="text-display duration-input"></span></td><td><span class="text-display amount-input"></span></td></tr>
                    <tr><td><span class="text-display" style="width: 100%;"></span></td><td colspan="2"><span class="text-display time-range-input"></span></td><td><span class="text-display duration-input"></span></td><td colspan="2"><span class="text-display time-range-input"></span></td><td><span class="text-display duration-input"></span></td><td><span class="text-display amount-input"></span></td></tr>
                    <tr><td><span class="text-display" style="width: 100%;"></span></td><td colspan="2"><span class="text-display time-range-input"></span></td><td><span class="text-display duration-input"></span></td><td colspan="2"><span class="text-display time-range-input"></span></td><td><span class="text-display duration-input"></span></td><td><span class="text-display amount-input"></span></td></tr>
                    <!-- åˆè¨ˆè¡Œ -->
                    <tr style="background-color: #e6e6e6;">
                        <td></td>
                        <td colspan="2">æ—¥ä¸­åˆ©ç”¨æ™‚é–“åˆè¨ˆ</td>
                        <td><span class="text-display duration-input"></span></td>
                        <td colspan="2">å¤œé–“åˆ©ç”¨æ™‚é–“åˆè¨ˆ</td>
                        <td><span class="text-display duration-input"></span></td>
                        <td>ï¿¥ <span class="text-display amount-input" style="width: 80%;"></span></td>
                    </tr>
                    <tr style="background-color: #e6e6e6;">
                        <td></td>
                        <td colspan="2">ä»–ãƒšãƒ¼ã‚¸å«ã‚€ç·è¨ˆ</td>
                        <td><span class="text-display duration-input"></span></td>
                        <td colspan="2">ä»–ãƒšãƒ¼ã‚¸å«ã‚€ç·è¨ˆ</td>
                        <td><span class="text-display duration-input"></span></td>
                        <td>ï¿¥ <span class="text-display amount-input" style="width: 80%;"></span></td>
                    </tr>
                </tbody>
            </table>
            
            <div class="calculation-section">
                <div>
                    <div style="font-size: 10px;">æ—¥ä¸­åˆ©ç”¨æ™‚é–“</div>
                    <div style="font-size: 10px;">(60åˆ†æœªæº€åˆ‡æ¨)</div>
                    <div class="calc-box">
                        <span class="text-display"></span> æ™‚é–“
                    </div>
                </div>
                <div>Ã—</div>
                <div>2,500å††</div>
                <div>+</div>
                <div>
                    <div style="font-size: 10px;">å¤œé–“åˆ©ç”¨æ™‚é–“</div>
                    <div style="font-size: 10px;">(60åˆ†æœªæº€åˆ‡æ¨)</div>
                    <div class="calc-box">
                        <span class="text-display"></span> æ™‚é–“
                    </div>
                </div>
                <div>Ã—</div>
                <div>3,500å††</div>
                <div>=</div>
                <div class="calc-box" style="background-color: #cce6ff;">
                    <div style="font-size: 10px;">è£œåŠ©åŸºæº–é¡</div>
                    ï¿¥ <span class="text-display"></span>
                </div>
            </div>
            
            <div class="subsidy-info">
                â€»è£œåŠ©æ™‚é–“æ•°ã®ä¸Šé™ã¯å…ç«¥1äººã‚ãŸã‚Š1ãƒ¶æœˆå¹´åº¦å†…ã§<strong>144æ™‚é–“</strong><br>
                ï¼ˆå¤šèƒå…ã®å ´åˆã¯1äººã‚ãŸã‚Š<strong>288æ™‚é–“</strong>ï¼‰ã§ã™ã€‚
            </div>
            
            <div class="payment-section">
                <div style="display: flex; align-items: center; gap: 5px;">
                    <span style="background-color: red; color: white; padding: 2px 5px; font-size: 10px;">A</span>
                    <span>ã¨</span>
                    <span style="background-color: blue; color: white; padding: 2px 5px; font-size: 10px;">B</span>
                    <span>ã®</span>
                    <br>
                    <span style="font-size: 10px;">å°ã•ã„æ–¹ã®é‡‘é¡</span>
                </div>
                <div class="payment-box highlight">
                    <div style="font-size: 10px;">äº¤ä»˜è«‹æ±‚é¡</div>
                    ï¿¥ <span class="text-display"></span>
                </div>
                <div class="payment-box">
                    <div style="font-size: 10px;">ä½¿ç”¨æ™‚é–“æ•°</div>
                    <span class="text-display"></span> æ™‚é–“
                </div>
            </div>
            
            <div class="page-number">1 ãƒšãƒ¼ã‚¸</div>
        </div>

        <!-- ãƒšãƒ¼ã‚¸2 -->
        <div class="page-container a4-portrait" id="page2">
            <div class="page-number-display">ãƒšãƒ¼ã‚¸ 2</div>
            
            <div class="date-section">
                ä»¤å’Œ <span class="text-display" id="year-page2-1" style="width: 30px; border-bottom: 1px solid black; display: inline-block; text-align: center; min-height: 18px; padding: 2px 0;">7</span> å¹´ <span class="text-display" id="month-page2-1" style="width: 30px; border-bottom: 1px solid black; display: inline-block; text-align: center; min-height: 18px; padding: 2px 0;">4</span> æœˆåˆ†
            </div>
            
            <table class="usage-table">
                <thead>
                    <tr>
                        <th rowspan="3">åˆ©ç”¨æ—¥</th>
                        <th colspan="6">åˆ©ç”¨æ™‚é–“</th>
                        <th rowspan="3">å®Ÿæ”¯æ‰•é¡</th>
                    </tr>
                    <tr>
                        <th colspan="3">æ—¥ä¸­åˆ©ç”¨ï¼ˆ7æ™‚ï½22æ™‚ï¼‰</th>
                        <th colspan="3">å¤œé–“åˆ©ç”¨ï¼ˆ22æ™‚ï½ç¿Œ7æ™‚ï¼‰</th>
                    </tr>
                    <tr>
                        <th colspan="2">æ™‚é–“</th>
                        <th>â—‹æ™‚é–“â—‹åˆ†</th>
                        <th colspan="2">æ™‚é–“</th>
                        <th>â—‹æ™‚é–“â—‹åˆ†</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- 12è¡Œã®ãƒ‡ãƒ¼ã‚¿å…¥åŠ›è¡Œ -->
                    <tr><td><span class="text-display" style="width: 100%;"></span></td><td colspan="2"><span class="text-display time-range-input"></span></td><td><span class="text-display duration-input"></span></td><td colspan="2"><span class="text-display time-range-input"></span></td><td><span class="text-display duration-input"></span></td><td><span class="text-display amount-input"></span></td></tr>
                    <tr><td><span class="text-display" style="width: 100%;"></span></td><td colspan="2"><span class="text-display time-range-input"></span></td><td><span class="text-display duration-input"></span></td><td colspan="2"><span class="text-display time-range-input"></span></td><td><span class="text-display duration-input"></span></td><td><span class="text-display amount-input"></span></td></tr>
                    <tr><td><span class="text-display" style="width: 100%;"></span></td><td colspan="2"><span class="text-display time-range-input"></span></td><td><span class="text-display duration-input"></span></td><td colspan="2"><span class="text-display time-range-input"></span></td><td><span class="text-display duration-input"></span></td><td><span class="text-display amount-input"></span></td></tr>
                    <tr><td><span class="text-display" style="width: 100%;"></span></td><td colspan="2"><span class="text-display time-range-input"></span></td><td><span class="text-display duration-input"></span></td><td colspan="2"><span class="text-display time-range-input"></span></td><td><span class="text-display duration-input"></span></td><td><span class="text-display amount-input"></span></td></tr>
                    <tr><td><span class="text-display" style="width: 100%;"></span></td><td colspan="2"><span class="text-display time-range-input"></span></td><td><span class="text-display duration-input"></span></td><td colspan="2"><span class="text-display time-range-input"></span></td><td><span class="text-display duration-input"></span></td><td><span class="text-display amount-input"></span></td></tr>
                    <tr><td><span class="text-display" style="width: 100%;"></span></td><td colspan="2"><span class="text-display time-range-input"></span></td><td><span class="text-display duration-input"></span></td><td colspan="2"><span class="text-display time-range-input"></span></td><td><span class="text-display duration-input"></span></td><td><span class="text-display amount-input"></span></td></tr>
                    <tr><td><span class="text-display" style="width: 100%;"></span></td><td colspan="2"><span class="text-display time-range-input"></span></td><td><span class="text-display duration-input"></span></td><td colspan="2"><span class="text-display time-range-input"></span></td><td><span class="text-display duration-input"></span></td><td><span class="text-display amount-input"></span></td></tr>
                    <tr><td><span class="text-display" style="width: 100%;"></span></td><td colspan="2"><span class="text-display time-range-input"></span></td><td><span class="text-display duration-input"></span></td><td colspan="2"><span class="text-display time-range-input"></span></td><td><span class="text-display duration-input"></span></td><td><span class="text-display amount-input"></span></td></tr>
                    <tr><td><span class="text-display" style="width: 100%;"></span></td><td colspan="2"><span class="text-display time-range-input"></span></td><td><span class="text-display duration-input"></span></td><td colspan="2"><span class="text-display time-range-input"></span></td><td><span class="text-display duration-input"></span></td><td><span class="text-display amount-input"></span></td></tr>
                    <tr><td><span class="text-display" style="width: 100%;"></span></td><td colspan="2"><span class="text-display time-range-input"></span></td><td><span class="text-display duration-input"></span></td><td colspan="2"><span class="text-display time-range-input"></span></td><td><span class="text-display duration-input"></span></td><td><span class="text-display amount-input"></span></td></tr>
                    <tr><td><span class="text-display" style="width: 100%;"></span></td><td colspan="2"><span class="text-display time-range-input"></span></td><td><span class="text-display duration-input"></span></td><td colspan="2"><span class="text-display time-range-input"></span></td><td><span class="text-display duration-input"></span></td><td><span class="text-display amount-input"></span></td></tr>
                    <tr><td><span class="text-display" style="width: 100%;"></span></td><td colspan="2"><span class="text-display time-range-input"></span></td><td><span class="text-display duration-input"></span></td><td colspan="2"><span class="text-display time-range-input"></span></td><td><span class="text-display duration-input"></span></td><td><span class="text-display amount-input"></span></td></tr>
                    <!-- åˆè¨ˆè¡Œ -->
                    <tr style="background-color: #e6e6e6;">
                        <td></td>
                        <td colspan="2">æ—¥ä¸­åˆ©ç”¨æ™‚é–“åˆè¨ˆ</td>
                        <td><span class="text-display duration-input"></span></td>
                        <td colspan="2">å¤œé–“åˆ©ç”¨æ™‚é–“åˆè¨ˆ</td>
                        <td><span class="text-display duration-input"></span></td>
                        <td>ï¿¥ <span class="text-display amount-input" style="width: 80%;"></span></td>
                    </tr>
                </tbody>
            </table>
            
            <div class="date-section">
                ä»¤å’Œ <span class="text-display" id="year-page2-2" style="width: 30px; border-bottom: 1px solid black; display: inline-block; text-align: center; min-height: 18px; padding: 2px 0;">7</span> å¹´ <span class="text-display" id="month-page2-2" style="width: 30px; border-bottom: 1px solid black; display: inline-block; text-align: center; min-height: 18px; padding: 2px 0;">5</span> æœˆåˆ†
            </div>
            
            <table class="usage-table">
                <thead>
                    <tr>
                        <th rowspan="3">åˆ©ç”¨æ—¥</th>
                        <th colspan="6">åˆ©ç”¨æ™‚é–“</th>
                        <th rowspan="3">å®Ÿæ”¯æ‰•é¡</th>
                    </tr>
                    <tr>
                        <th colspan="3">æ—¥ä¸­åˆ©ç”¨ï¼ˆ7æ™‚ï½22æ™‚ï¼‰</th>
                        <th colspan="3">å¤œé–“åˆ©ç”¨ï¼ˆ22æ™‚ï½ç¿Œ7æ™‚ï¼‰</th>
                    </tr>
                    <tr>
                        <th colspan="2">æ™‚é–“</th>
                        <th>â—‹æ™‚é–“â—‹åˆ†</th>
                        <th colspan="2">æ™‚é–“</th>
                        <th>â—‹æ™‚é–“â—‹åˆ†</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- 7è¡Œã®ãƒ‡ãƒ¼ã‚¿å…¥åŠ›è¡Œ -->
                    <tr><td><span class="text-display" style="width: 100%;"></span></td><td colspan="2"><span class="text-display time-range-input"></span></td><td><span class="text-display duration-input"></span></td><td colspan="2"><span class="text-display time-range-input"></span></td><td><span class="text-display duration-input"></span></td><td><span class="text-display amount-input"></span></td></tr>
                    <tr><td><span class="text-display" style="width: 100%;"></span></td><td colspan="2"><span class="text-display time-range-input"></span></td><td><span class="text-display duration-input"></span></td><td colspan="2"><span class="text-display time-range-input"></span></td><td><span class="text-display duration-input"></span></td><td><span class="text-display amount-input"></span></td></tr>
                    <tr><td><span class="text-display" style="width: 100%;"></span></td><td colspan="2"><span class="text-display time-range-input"></span></td><td><span class="text-display duration-input"></span></td><td colspan="2"><span class="text-display time-range-input"></span></td><td><span class="text-display duration-input"></span></td><td><span class="text-display amount-input"></span></td></tr>
                    <tr><td><span class="text-display" style="width: 100%;"></span></td><td colspan="2"><span class="text-display time-range-input"></span></td><td><span class="text-display duration-input"></span></td><td colspan="2"><span class="text-display time-range-input"></span></td><td><span class="text-display duration-input"></span></td><td><span class="text-display amount-input"></span></td></tr>
                    <tr><td><span class="text-display" style="width: 100%;"></span></td><td colspan="2"><span class="text-display time-range-input"></span></td><td><span class="text-display duration-input"></span></td><td colspan="2"><span class="text-display time-range-input"></span></td><td><span class="text-display duration-input"></span></td><td><span class="text-display amount-input"></span></td></tr>
                    <tr><td><span class="text-display" style="width: 100%;"></span></td><td colspan="2"><span class="text-display time-range-input"></span></td><td><span class="text-display duration-input"></span></td><td colspan="2"><span class="text-display time-range-input"></span></td><td><span class="text-display duration-input"></span></td><td><span class="text-display amount-input"></span></td></tr>
                    <tr><td><span class="text-display" style="width: 100%;"></span></td><td colspan="2"><span class="text-display time-range-input"></span></td><td><span class="text-display duration-input"></span></td><td colspan="2"><span class="text-display time-range-input"></span></td><td><span class="text-display duration-input"></span></td><td><span class="text-display amount-input"></span></td></tr>
                    <!-- åˆè¨ˆè¡Œ -->
                    <tr style="background-color: #e6e6e6;">
                        <td></td>
                        <td colspan="2">æ—¥ä¸­åˆ©ç”¨æ™‚é–“åˆè¨ˆ</td>
                        <td><span class="text-display duration-input"></span></td>
                        <td colspan="2">å¤œé–“åˆ©ç”¨æ™‚é–“åˆè¨ˆ</td>
                        <td><span class="text-display duration-input"></span></td>
                        <td>ï¿¥ <span class="text-display amount-input" style="width: 80%;"></span></td>
                    </tr>
                </tbody>
            </table>
            
            <div style="text-align: center; background-color: #ffff00; padding: 10px; margin: 20px 0; font-weight: bold;">
                è¨˜è¼‰ã™ã‚‹è¡ŒãŒä¸è¶³ã™ã‚‹å ´åˆã¯ã€ç¶šãã‚’2ãƒšãƒ¼ã‚¸ç›®ã¨åŒæ§˜ã«è¨˜è¼‰ã—ã¦ãã ã•ã„ã€‚
            </div>
            
            <div class="page-number">2 ãƒšãƒ¼ã‚¸</div>
        </div>
    </div>

    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let currentZoom = 100;
        let sidebarOpen = false;

        // DOMè¦ç´ ã®å–å¾—
        const sidebar = document.getElementById('sidebar');
        const mainContent = document.getElementById('mainContent');
        const zoomSelect = document.getElementById('zoomSelect');
        const printBtn = document.getElementById('printBtn');
        const paginateBtn = document.getElementById('paginateBtn');
        const pageInfo = document.getElementById('pageInfo');
        const loadJsonBtn = document.getElementById('loadJsonBtn');
        const jsonFileInput = document.getElementById('jsonFileInput');

        // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®è¨­å®š
        if (zoomSelect) zoomSelect.addEventListener('change', changeZoom);
        if (printBtn) printBtn.addEventListener('click', printDocument);
        if (paginateBtn) paginateBtn.addEventListener('click', paginateContent);

        // ãƒ‡ãƒ¼ã‚¿æ›´æ–°ãƒœã‚¿ãƒ³
        const refreshBtn = document.getElementById('refreshBtn');
        if (refreshBtn) {
            refreshBtn.addEventListener('click', function() {
                // æ‰‹å‹•èª­ã¿è¾¼ã¿ãƒ•ãƒ©ã‚°ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¦ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ‡ãƒ¼ã‚¿ã«æˆ»ã™
                isManuallyLoadedData = false;
                autoLoadData();
            });
        }

        // JSONãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ãƒœã‚¿ãƒ³
        if (loadJsonBtn) {
            loadJsonBtn.addEventListener('click', function() {
                jsonFileInput.click();
            });
        }

        // JSONãƒ•ã‚¡ã‚¤ãƒ«é¸æŠæ™‚ã®å‡¦ç†
        if (jsonFileInput) {
            jsonFileInput.addEventListener('change', async function(e) {
                const file = e.target.files[0];
                if (!file) return;

                try {
                    const text = await file.text();
                    const jsonData = JSON.parse(text);

                    // JSONãƒ‡ãƒ¼ã‚¿ã‚’ãƒ•ã‚©ãƒ¼ãƒ ã«èª­ã¿è¾¼ã‚€
                    await loadFormData(jsonData);

                    // æ‰‹å‹•èª­ã¿è¾¼ã¿ãƒ•ãƒ©ã‚°ã‚’è¨­å®š
                    isManuallyLoadedData = true;

                    alert('JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ');

                    // å…¥åŠ›ã‚’ãƒªã‚»ãƒƒãƒˆï¼ˆåŒã˜ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å†åº¦é¸æŠå¯èƒ½ã«ã™ã‚‹ï¼‰
                    jsonFileInput.value = '';
                } catch (error) {
                    alert('JSONãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
                    console.error('JSONèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
                }
            });
        }

        // ã‚µã‚¤ãƒ‰ãƒãƒ¼ã®é–‹é–‰
        function toggleSidebar() {
            sidebarOpen = !sidebarOpen;
            if (sidebar) sidebar.classList.toggle('open', sidebarOpen);
            if (mainContent) mainContent.classList.toggle('sidebar-open', sidebarOpen);
        }

        // ã‚ºãƒ¼ãƒ æ©Ÿèƒ½
        function changeZoom() {
            currentZoom = parseInt(zoomSelect.value);
            const pages = document.querySelectorAll('.page-container');
            pages.forEach(page => {
                page.className = page.className.replace(/zoom-\d+/, `zoom-${currentZoom}`);
            });
        }

        // è¨­å®šã®é©ç”¨
        function applySettings() {
            const paperSize = document.getElementById('paperSize').value;
            const orientation = document.getElementById('orientation').value;
            const marginTop = document.getElementById('marginTop').value;
            const marginRight = document.getElementById('marginRight').value;
            const marginBottom = document.getElementById('marginBottom').value;
            const marginLeft = document.getElementById('marginLeft').value;
            const headerText = document.getElementById('headerText').value;
            const footerText = document.getElementById('footerText').value;

            // ãƒšãƒ¼ã‚¸ã‚µã‚¤ã‚ºã¨ãƒãƒ¼ã‚¸ãƒ³ã®é©ç”¨
            const pages = document.querySelectorAll('.page-container');
            pages.forEach(page => {
                // ãƒšãƒ¼ã‚¸ã‚µã‚¤ã‚ºã‚¯ãƒ©ã‚¹ã®æ›´æ–°
                page.className = page.className.replace(/a4-(portrait|landscape)/, `${paperSize}-${orientation}`);
                
                // ãƒãƒ¼ã‚¸ãƒ³ã®é©ç”¨
                page.style.setProperty('--page-margin-top', `${marginTop}mm`);
                page.style.setProperty('--page-margin-right', `${marginRight}mm`);
                page.style.setProperty('--page-margin-bottom', `${marginBottom}mm`);
                page.style.setProperty('--page-margin-left', `${marginLeft}mm`);
            });

            // å°åˆ·è¨­å®šã®é©ç”¨
            document.documentElement.style.setProperty('--print-page-size', paperSize.toUpperCase());
            document.documentElement.style.setProperty('--print-orientation', orientation);

            // ãƒ˜ãƒƒãƒ€ãƒ¼ãƒ»ãƒ•ãƒƒã‚¿ãƒ¼ã®è¿½åŠ ï¼ˆç°¡æ˜“å®Ÿè£…ï¼‰
            if (headerText || footerText) {
                addHeaderFooter(headerText, footerText);
            }

            alert('è¨­å®šãŒé©ç”¨ã•ã‚Œã¾ã—ãŸ');
        }

        // ãƒ˜ãƒƒãƒ€ãƒ¼ãƒ»ãƒ•ãƒƒã‚¿ãƒ¼ã®è¿½åŠ 
        function addHeaderFooter(header, footer) {
            const pages = document.querySelectorAll('.page-container');
            pages.forEach(page => {
                // æ—¢å­˜ã®ãƒ˜ãƒƒãƒ€ãƒ¼ãƒ»ãƒ•ãƒƒã‚¿ãƒ¼ã‚’å‰Šé™¤
                const existingHeader = page.querySelector('.custom-header');
                const existingFooter = page.querySelector('.custom-footer');
                if (existingHeader) existingHeader.remove();
                if (existingFooter) existingFooter.remove();

                // ãƒ˜ãƒƒãƒ€ãƒ¼ã®è¿½åŠ 
                if (header) {
                    const headerDiv = document.createElement('div');
                    headerDiv.className = 'custom-header';
                    headerDiv.style.cssText = 'position: absolute; top: 10mm; left: 0; right: 0; text-align: center; font-size: 10px; color: #666;';
                    headerDiv.textContent = header;
                    page.style.position = 'relative';
                    page.appendChild(headerDiv);
                }

                // ãƒ•ãƒƒã‚¿ãƒ¼ã®è¿½åŠ 
                if (footer) {
                    const footerDiv = document.createElement('div');
                    footerDiv.className = 'custom-footer';
                    footerDiv.style.cssText = 'position: absolute; bottom: 10mm; left: 0; right: 0; text-align: center; font-size: 10px; color: #666;';
                    footerDiv.textContent = footer;
                    page.style.position = 'relative';
                    page.appendChild(footerDiv);
                }
            });
        }

        // å°åˆ·æ©Ÿèƒ½
        function printDocument() {
            // å°åˆ·å‰ã«ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ã‚’ç¢ºå®Ÿã«éè¡¨ç¤º
            const toolbar = document.querySelector('.toolbar');
            const sidebar = document.querySelector('.sidebar');

            if (toolbar) toolbar.style.display = 'none';
            if (sidebar) sidebar.style.display = 'none';

            // å°åˆ·å®Ÿè¡Œ
            window.print();

            // å°åˆ·å¾Œã«å¾©å…ƒ
            setTimeout(() => {
                if (toolbar) toolbar.style.display = '';
                if (sidebar) sidebar.style.display = '';
            }, 100);
        }


        // ãƒšãƒ¼ã‚¸åˆ†å‰²æ©Ÿèƒ½
        function paginateContent() {
            const pages = document.querySelectorAll('.page-container');
            let totalPages = 0;
            
            pages.forEach((page, index) => {
                const result = splitPageIfNeeded(page, index + 1);
                totalPages += result.pageCount;
            });
            
            updatePageInfo(totalPages);
            alert(`ãƒšãƒ¼ã‚¸åˆ†å‰²å®Œäº†: ${totalPages}ãƒšãƒ¼ã‚¸ã«åˆ†å‰²ã•ã‚Œã¾ã—ãŸ`);
        }

        // ãƒšãƒ¼ã‚¸åˆ†å‰²ãŒå¿…è¦ã‹ãƒã‚§ãƒƒã‚¯ã—ã€å¿…è¦ã§ã‚ã‚Œã°åˆ†å‰²
        function splitPageIfNeeded(pageContainer, originalPageNumber) {
            const pageHeight = 297; // A4ç¸¦ã®mm
            const marginTop = parseFloat(getComputedStyle(pageContainer).getPropertyValue('--page-margin-top')) || 20;
            const marginBottom = parseFloat(getComputedStyle(pageContainer).getPropertyValue('--page-margin-bottom')) || 20;
            const availableHeight = pageHeight - marginTop - marginBottom;
            
            // ä¸€æ™‚çš„ã«é«˜ã•åˆ¶é™ã‚’è§£é™¤ã—ã¦å®Ÿéš›ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„é«˜ã•ã‚’æ¸¬å®š
            pageContainer.style.maxHeight = 'none';
            pageContainer.style.overflow = 'visible';
            
            const contentHeight = pageContainer.scrollHeight;
            const maxContentHeight = availableHeight * 0.95; // å°‘ã—ä½™è£•ã‚’æŒãŸã›ã‚‹
            
            if (contentHeight <= maxContentHeight) {
                // åˆ†å‰²ä¸è¦
                pageContainer.style.maxHeight = '297mm';
                pageContainer.style.overflow = 'hidden';
                return { pageCount: 1 };
            }

            // åˆ†å‰²ãŒå¿…è¦
            return splitPageContent(pageContainer, originalPageNumber, maxContentHeight);
        }

        // ãƒšãƒ¼ã‚¸ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’å®Ÿéš›ã«åˆ†å‰²
        function splitPageContent(pageContainer, originalPageNumber, maxHeight) {
            const tables = pageContainer.querySelectorAll('.usage-table');
            let pageCount = 1;
            
            tables.forEach(table => {
                const result = splitTableIfNeeded(table, pageContainer, maxHeight);
                if (result.split) {
                    pageCount += result.additionalPages;
                }
            });
            
            return { pageCount };
        }

        // ãƒ†ãƒ¼ãƒ–ãƒ«ã®åˆ†å‰²å‡¦ç†
        function splitTableIfNeeded(table, pageContainer, maxHeight) {
            const rows = table.querySelectorAll('tbody tr');
            const rowHeight = 30; // æ¦‚ç®—ã®è¡Œé«˜ã•ï¼ˆpxï¼‰
            const headerHeight = 60; // ãƒ˜ãƒƒãƒ€ãƒ¼ã®é«˜ã•
            
            const maxRowsPerPage = Math.floor((maxHeight - headerHeight) / rowHeight);
            
            if (rows.length <= maxRowsPerPage) {
                return { split: false, additionalPages: 0 };
            }

            // ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’åˆ†å‰²
            const originalTable = table.cloneNode(true);
            const thead = table.querySelector('thead').cloneNode(true);
            
            // å…ƒã®ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’æœ€åˆã®ãƒšãƒ¼ã‚¸ç”¨ã«èª¿æ•´
            const firstPageRows = Array.from(rows).slice(0, maxRowsPerPage);
            const tbody = table.querySelector('tbody');
            tbody.innerHTML = '';
            firstPageRows.forEach(row => tbody.appendChild(row));

            // æ®‹ã‚Šã®è¡Œã§æ–°ã—ã„ãƒšãƒ¼ã‚¸ã‚’ä½œæˆ
            const remainingRows = Array.from(rows).slice(maxRowsPerPage);
            let additionalPages = 0;
            
            while (remainingRows.length > 0) {
                additionalPages++;
                const newPage = createContinuationPage(pageContainer, additionalPages);
                const newTable = createContinuationTable(thead, remainingRows.slice(0, maxRowsPerPage));
                
                newPage.appendChild(newTable);
                pageContainer.parentNode.insertBefore(newPage, pageContainer.nextSibling);
                
                remainingRows.splice(0, maxRowsPerPage);
            }

            return { split: true, additionalPages };
        }

        // ç¶™ç¶šãƒšãƒ¼ã‚¸ã®ä½œæˆ
        function createContinuationPage(originalPage, pageNumber) {
            const newPage = document.createElement('div');
            newPage.className = originalPage.className;
            newPage.innerHTML = `
                <div class="page-number-display">ãƒšãƒ¼ã‚¸ ${pageNumber + 1}</div>
                <div class="page-number">${pageNumber + 1} ãƒšãƒ¼ã‚¸</div>
            `;
            return newPage;
        }

        // ç¶™ç¶šãƒ†ãƒ¼ãƒ–ãƒ«ã®ä½œæˆ
        function createContinuationTable(thead, rows) {
            const table = document.createElement('table');
            table.className = 'usage-table table-continuation';
            
            table.appendChild(thead);
            
            const tbody = document.createElement('tbody');
            rows.forEach(row => tbody.appendChild(row.cloneNode(true)));
            table.appendChild(tbody);
            
            return table;
        }

        // ãƒšãƒ¼ã‚¸æƒ…å ±ã®æ›´æ–°
        function updatePageInfo(totalPages) {
            pageInfo.textContent = `ãƒšãƒ¼ã‚¸ 1-${totalPages}`;
        }

        // è‡ªå‹•ãƒšãƒ¼ã‚¸åˆ†å‰²ï¼ˆã‚³ãƒ³ãƒ†ãƒ³ãƒ„å¤‰æ›´æ™‚ï¼‰
        function autoCheckPagination() {
            // ãƒ•ã‚©ãƒ¼ãƒ å…¥åŠ›æ™‚ã«è‡ªå‹•ã§ãƒšãƒ¼ã‚¸åˆ†å‰²ã‚’ãƒã‚§ãƒƒã‚¯
            const inputs = document.querySelectorAll('input');
            inputs.forEach(input => {
                input.addEventListener('input', debounce(() => {
                    checkIfPaginationNeeded();
                }, 500));
            });
        }

        // ãƒšãƒ¼ã‚¸åˆ†å‰²ãŒå¿…è¦ã‹ãƒã‚§ãƒƒã‚¯
        function checkIfPaginationNeeded() {
            const pages = document.querySelectorAll('.page-container');
            let needsPagination = false;
            
            pages.forEach(page => {
                const contentHeight = page.scrollHeight;
                const maxHeight = 297 * 3.779527559; // mmã‚’pxã«å¤‰æ›
                
                if (contentHeight > maxHeight) {
                    needsPagination = true;
                    page.classList.add('page-overflow');
                } else {
                    page.classList.remove('page-overflow');
                }
            });
            
            if (needsPagination) {
                paginateBtn.style.backgroundColor = '#ff6b6b';
                paginateBtn.style.color = 'white';
            } else {
                paginateBtn.style.backgroundColor = '';
                paginateBtn.style.color = '';
            }
        }

        // ãƒ‡ãƒã‚¦ãƒ³ã‚¹é–¢æ•°
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // JSONãƒ‡ãƒ¼ã‚¿ã‚’ãƒ•ã‚©ãƒ¼ãƒ ã«èª­ã¿è¾¼ã‚€é–¢æ•°
        async function loadFormData(jsonData = null) {
            try {
                let data;

                // å¼•æ•°ã¨ã—ã¦JSONãƒ‡ãƒ¼ã‚¿ãŒæ¸¡ã•ã‚ŒãŸå ´åˆã¯ãã‚Œã‚’ä½¿ç”¨
                if (jsonData) {
                    data = jsonData;
                } else {
                    // é€šå¸¸ã¯form_data.jsonã‚’èª­ã¿è¾¼ã‚€
                    const response = await fetch('/data/form_data.json');
                    if (!response.ok) {
                        console.log('form_data.jsonãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚ç©ºã®ãƒ•ã‚©ãƒ¼ãƒ ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚');
                        return;
                    }
                    data = await response.json();
                }
                
                // å¹´åº¦ã‚’è¨­å®š
                const yearElement = document.querySelector('.year-field .text-display');
                if (yearElement && data.year) {
                    yearElement.textContent = data.year;
                }

                // ç”³è«‹è€…åã¨å…ç«¥åã‚’è¨­å®š
                const applicantElement = document.querySelector('.info-row:nth-child(1) .info-input');
                const childElement = document.querySelector('.info-row:nth-child(2) .info-input');
                if (applicantElement && data.applicantName) {
                    applicantElement.textContent = data.applicantName;
                }
                if (childElement && data.childName) {
                    childElement.textContent = data.childName;
                }

                // ãƒšãƒ¼ã‚¸1ã®ãƒ‡ãƒ¼ã‚¿ã‚’è¨­å®š
                if (data.page1) {
                    // æœˆã‚’è¨­å®š
                    const page1MonthElement = document.querySelector('#month');
                    if (page1MonthElement && data.month) {
                        page1MonthElement.textContent = data.month;
                    }

                    // è¡Œãƒ‡ãƒ¼ã‚¿ã‚’è¨­å®š
                    const page1Rows = document.querySelectorAll('#page1 .usage-table tbody tr:not([style*="background-color"])');
                    data.page1.rows.forEach((rowData, index) => {
                        if (page1Rows[index]) {
                            const textElements = page1Rows[index].querySelectorAll('.text-display');
                            if (textElements[0] && rowData.date) textElements[0].textContent = rowData.date;
                            if (textElements[1] && rowData.dayTime) textElements[1].textContent = rowData.dayTime;
                            if (textElements[2] && rowData.dayDuration) textElements[2].textContent = rowData.dayDuration;
                            if (textElements[3] && rowData.nightTime) textElements[3].textContent = rowData.nightTime;
                            if (textElements[4] && rowData.nightDuration) textElements[4].textContent = rowData.nightDuration;
                            if (textElements[5] && rowData.amount) textElements[5].textContent = rowData.amount;
                        }
                    });

                    // åˆè¨ˆè¡Œã‚’è¨­å®š
                    const totalRows = document.querySelectorAll('#page1 .usage-table tbody tr[style*="background-color"]');
                    if (totalRows[0]) {
                        const textElements = totalRows[0].querySelectorAll('.text-display');
                        if (textElements[0] && data.page1.dayTotalTime) textElements[0].textContent = data.page1.dayTotalTime;
                        if (textElements[1] && data.page1.nightTotalTime) textElements[1].textContent = data.page1.nightTotalTime;
                        if (textElements[2] && data.page1.totalAmount) textElements[2].textContent = data.page1.totalAmount;
                    }

                    // ä»–ãƒšãƒ¼ã‚¸å«ã‚€ç·è¨ˆè¡Œã‚’è¨­å®š
                    if (totalRows[1] && data.page1) {
                        const textElements = totalRows[1].querySelectorAll('.text-display');
                        if (textElements[0] && data.page1.grandTotalDayTime) textElements[0].textContent = data.page1.grandTotalDayTime;
                        if (textElements[1] && data.page1.grandTotalNightTime) textElements[1].textContent = data.page1.grandTotalNightTime;
                        if (textElements[2] && data.page1.grandTotalAmount) textElements[2].textContent = data.page1.grandTotalAmount;
                    }

                    // è¨ˆç®—ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¨­å®š
                    const calcElements = document.querySelectorAll('#page1 .calculation-section .text-display');
                    if (calcElements[0] && data.page1.dayHours) calcElements[0].textContent = data.page1.dayHours;
                    if (calcElements[1] && data.page1.nightHours) calcElements[1].textContent = data.page1.nightHours;
                    if (calcElements[2] && data.page1.subsidyAmount) calcElements[2].textContent = data.page1.subsidyAmount;

                    // æ”¯æ‰•ã„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¨­å®š
                    const paymentElements = document.querySelectorAll('#page1 .payment-section .text-display');
                    if (paymentElements[0] && data.page1.requestAmount) paymentElements[0].textContent = data.page1.requestAmount;
                    if (paymentElements[1] && data.page1.usageHours) paymentElements[1].textContent = data.page1.usageHours;
                }
                
                // ãƒšãƒ¼ã‚¸2ã®ãƒ‡ãƒ¼ã‚¿ã‚’è¨­å®š
                if (data.page2) {
                    // æœˆ1ã‚’è¨­å®š
                    const month1Element = document.querySelector('#month-page2-1');
                    if (month1Element && data.page2.month1) {
                        month1Element.textContent = data.page2.month1;
                    }

                    // æœˆ2ã‚’è¨­å®š
                    const month2Element = document.querySelector('#month-page2-2');
                    if (month2Element && data.page2.month2) {
                        month2Element.textContent = data.page2.month2;
                    }

                    // ãƒ†ãƒ¼ãƒ–ãƒ«1
                    const page2Tables = document.querySelectorAll('#page2 .usage-table');
                    if (page2Tables[0] && data.page2.table1) {
                        const rows = page2Tables[0].querySelectorAll('tbody tr:not([style*="background-color"])');
                        data.page2.table1.rows.forEach((rowData, index) => {
                            if (rows[index]) {
                                const textElements = rows[index].querySelectorAll('.text-display');
                                if (textElements[0] && rowData.date) textElements[0].textContent = rowData.date;
                                if (textElements[1] && rowData.dayTime) textElements[1].textContent = rowData.dayTime;
                                if (textElements[2] && rowData.dayDuration) textElements[2].textContent = rowData.dayDuration;
                                if (textElements[3] && rowData.nightTime) textElements[3].textContent = rowData.nightTime;
                                if (textElements[4] && rowData.nightDuration) textElements[4].textContent = rowData.nightDuration;
                                if (textElements[5] && rowData.amount) textElements[5].textContent = rowData.amount;
                            }
                        });

                        // ãƒ†ãƒ¼ãƒ–ãƒ«1ã®åˆè¨ˆè¡Œã‚’è¨­å®š
                        const table1TotalRow = page2Tables[0].querySelector('tbody tr[style*="background-color"]');
                        if (table1TotalRow) {
                            const textElements = table1TotalRow.querySelectorAll('.text-display');
                            if (textElements[0] && data.page2.table1.dayTotalTime) textElements[0].textContent = data.page2.table1.dayTotalTime;
                            if (textElements[1] && data.page2.table1.nightTotalTime) textElements[1].textContent = data.page2.table1.nightTotalTime;
                            if (textElements[2] && data.page2.table1.totalAmount) textElements[2].textContent = data.page2.table1.totalAmount;
                        }
                    }

                    // ãƒ†ãƒ¼ãƒ–ãƒ«2
                    if (page2Tables[1] && data.page2.table2) {
                        const rows = page2Tables[1].querySelectorAll('tbody tr:not([style*="background-color"])');
                        data.page2.table2.rows.forEach((rowData, index) => {
                            if (rows[index]) {
                                const textElements = rows[index].querySelectorAll('.text-display');
                                if (textElements[0] && rowData.date) textElements[0].textContent = rowData.date;
                                if (textElements[1] && rowData.dayTime) textElements[1].textContent = rowData.dayTime;
                                if (textElements[2] && rowData.dayDuration) textElements[2].textContent = rowData.dayDuration;
                                if (textElements[3] && rowData.nightTime) textElements[3].textContent = rowData.nightTime;
                                if (textElements[4] && rowData.nightDuration) textElements[4].textContent = rowData.nightDuration;
                                if (textElements[5] && rowData.amount) textElements[5].textContent = rowData.amount;
                            }
                        });

                        // ãƒ†ãƒ¼ãƒ–ãƒ«2ã®åˆè¨ˆè¡Œã‚’è¨­å®š
                        const table2TotalRow = page2Tables[1].querySelector('tbody tr[style*="background-color"]');
                        if (table2TotalRow) {
                            const textElements = table2TotalRow.querySelectorAll('.text-display');
                            if (textElements[0] && data.page2.table2.dayTotalTime) textElements[0].textContent = data.page2.table2.dayTotalTime;
                            if (textElements[1] && data.page2.table2.nightTotalTime) textElements[1].textContent = data.page2.table2.nightTotalTime;
                            if (textElements[2] && data.page2.table2.totalAmount) textElements[2].textContent = data.page2.table2.totalAmount;
                        }
                    }
                }
                
                console.log('ãƒ•ã‚©ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ãŒæ­£å¸¸ã«èª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸã€‚');
            } catch (error) {
                console.error('ãƒ•ã‚©ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
            }
        }

        // ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã‚’è¿½è·¡ã™ã‚‹ãƒ•ãƒ©ã‚°
        let isManuallyLoadedData = false;

        // è‡ªå‹•ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿æ©Ÿèƒ½
        function autoLoadData() {
            // JSONãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€
            loadFormData().then(() => {
                console.log('ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ');
            }).catch(error => {
                console.error('ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
            });
        }

        // å®šæœŸçš„ãªãƒ‡ãƒ¼ã‚¿æ›´æ–°æ©Ÿèƒ½
        function startAutoRefresh() {
            // æ‰‹å‹•ã§èª­ã¿è¾¼ã¾ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã®å ´åˆã¯è‡ªå‹•æ›´æ–°ã‚’ã‚¹ã‚­ãƒƒãƒ—
            if (isManuallyLoadedData) {
                console.log('æ‰‹å‹•ã§èª­ã¿è¾¼ã¾ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã®ãŸã‚ã€è‡ªå‹•æ›´æ–°ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¾ã™');
                return;
            }
            setInterval(() => {
                autoLoadData();
            }, 30000); // 30ç§’ã”ã¨ã«æ›´æ–°
        }
        
        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ãƒã‚§ãƒƒã‚¯
            const urlParams = new URLSearchParams(window.location.search);
            const loadExtracted = urlParams.get('loadExtracted');

            if (loadExtracted === 'true') {
                // localStorageã‹ã‚‰æŠ½å‡ºãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€
                const extractedData = localStorage.getItem('extractedFormData');
                if (extractedData) {
                    try {
                        const jsonData = JSON.parse(extractedData);
                        loadFormData(jsonData);
                        // ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿å¾Œã«localStorageã‚’ã‚¯ãƒªã‚¢
                        localStorage.removeItem('extractedFormData');
                        // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢
                        window.history.replaceState({}, '', '/frontend/babysitter-form.html');
                        // æ‰‹å‹•èª­ã¿è¾¼ã¿ãƒ•ãƒ©ã‚°ã‚’è¨­å®š
                        isManuallyLoadedData = true;
                    } catch (error) {
                        console.error('æŠ½å‡ºãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
                        autoLoadData();
                    }
                } else {
                    autoLoadData();
                }
            } else {
                // é€šå¸¸ã®è‡ªå‹•ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
                autoLoadData();
            }
            
            // å®šæœŸçš„ãªãƒ‡ãƒ¼ã‚¿æ›´æ–°ã‚’é–‹å§‹
            setTimeout(() => {
                startAutoRefresh();
            }, 1000);
            
            // åˆæœŸã‚ºãƒ¼ãƒ ã®é©ç”¨
            changeZoom();
            
            // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§å°åˆ·ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’æœ‰åŠ¹ã«ã™ã‚‹
            setTimeout(() => {
                document.body.classList.add('print-preview-mode');
            }, 100);
            
            // è‡ªå‹•ãƒšãƒ¼ã‚¸åˆ†å‰²ãƒã‚§ãƒƒã‚¯ã®åˆæœŸåŒ–
            autoCheckPagination();
            
            // åˆæœŸãƒšãƒ¼ã‚¸åˆ†å‰²ãƒã‚§ãƒƒã‚¯
            setTimeout(checkIfPaginationNeeded, 200);
            
            // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ
            document.addEventListener('keydown', function(e) {
                if (e.ctrlKey || e.metaKey) {
                    switch(e.key) {
                        case 'p':
                            e.preventDefault();
                            printDocument();
                            break;
                        case ',':
                            e.preventDefault();
                            toggleSidebar();
                            break;
                        case 'd':
                            e.preventDefault();
                            paginateContent();
                            break;
                        case 'r':
                            e.preventDefault();
                            autoLoadData();
                            break;
                    }
                }
            });
        });
    </script>
</body>
</html>